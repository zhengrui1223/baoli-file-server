<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout" layout:decorator="layout">

<body class=" theme-blue" th:with="timestamp=${#dates.format(#dates.createNow(),'yyyyMMddHH')}">

<div class="content" layout:fragment="content">

    <div class="header">
        <h1 class="page-title">文件列表</h1>
        <ul class="breadcrumb">
            <li><a th:href="@{/home}">首页</a></li>
            <li class="active">文件列表</li>
        </ul>
    </div>

    <div class="main-content">

        <div class="btn-toolbar list-toolbar">
            <a class="btn btn-primary" href="#" data-toggle="modal" data-target="#uploadModal"><i class="fa fa-plus"></i> 上传文件</a>
            <div class="btn-group">
            </div>
        </div>
        <table class="table">
            <thead>
                <tr>
                    <th>文件名称</th>
                    <th>文件大小(MB)</th>
                    <th>文件下载</th>
                    <th>上传时间</th>
                    <th>上传者</th>
                    <th>图片缩略图</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody th:remove="all-but-first">
                <tr th:each="uploadFile:${uploadFileList}">
                    <td th:text="${uploadFile.fileName}">fileName</td>
                    <td th:text="${uploadFile.fileSize}">fileSize</td>
                    <td><a th:href="@{/downloadFile(groupName=${uploadFile.groupName},storePath=${uploadFile.storePath},fileName=${uploadFile.fileName})}">点击下载</a></td>
                    <td th:text="${#dates.format(uploadFile.createDate, 'yyyy-MM-dd HH:mm:ss')}">Onions</td>
                    <td th:text="${uploadFile.createUser}">createUser</td>
                    <td>
                        <img class="lazy" height="50px" width="40px" th:if="${uploadFile.imageType}" th:src="@{${uploadFile.filePath}}"/>
                    </td>
                    <td><a class="btn btn-danger" data-toggle="modal" data-target="#deleteFileModal" th:onclick="'setDeleteFile(\'' + ${uploadFile.id} + '\', \'' + ${uploadFile.filePath} + '\')'">删除</a></td>
                </tr>
            </tbody>
        </table>

        <ul class="pagination">
            <li><a href="#">&laquo;</a></li>
            <li><a href="#">1</a></li>
            <li><a href="#">2</a></li>
            <li><a href="#">3</a></li>
            <li><a href="#">4</a></li>
            <li><a href="#">5</a></li>
            <li><a href="#">&raquo;</a></li>
        </ul>

        <div class="modal small fade" id="deleteFileModal" tabindex="-1" role="dialog" aria-labelledby="deleteFileModalLabel" aria-hidden="true">
            <div class="modal-dialog" style="width:35%; margin-top: 15%">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h2 id="deleteFileModalLabel">删除确认</h2>
                    </div>
                    <div class="modal-body">
                        <p class="error-text"><i class="fa fa-warning modal-icon"></i>您确定要删除该文件? 文件删除后不可恢复.</p>
                    </div>
                    <div class="modal-footer">
                        <form method="get" id="deleteFileForm" th:action="@{/deleteFile}">
                            <input type="hidden" id="id" name="id"/>
                            <input type="hidden" id="filePath" name="filePath"/>
                        </form>
                        <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">取消</button>
                        <button class="btn btn-danger" data-dismiss="modal" th:onclick="'deleteFile()'">删除</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal small fade" id="uploadModal" tabindex="-1" role="dialog" aria-labelledby="uploadModalLabel" aria-hidden="true"  data-backdrop="static">
            <div class="modal-dialog" style="width:35%; margin-top: 15%">
                <div class="modal-content" style="height: auto">
                    <div class="modal-header">
                        <a type="button" class="close" data-dismiss="modal" aria-hidden="true" id="reloadFileList">×</a>
                        <h2 id="uploadModalLabel">文件上传(支持多选)</h2>
                    </div>
                    <div class="modal-body">
                        <form role="form" action="javascript:void(0)" style="margin-left: auto" id="uploadFileForm">
                            <div class="form-inline" style="margin-bottom: 10px; margin-left: 20%">
                                <div class="form-group">
                                    <input class="btn btn-default" type="file" name="files" id="files" multiple="multiple" dojoType="dojox.form.Uploader"/>
                                </div>

                                <div class="form-group">
                                    <input type="submit" id="uploadFilesBtn"  value="上传" class="btn btn-default" disabled="disabled"/>
                                </div>
                            </div>

                            <div class="form-group" id="successList" style="display: none;"/>
                            <div class="form-group" id="failList" style="display: none;color: red"/>

                            <div class="progress progress-striped active" style="display: none">
                                <div id="progressBar" class="progress-bar progress-bar-info"
                                     role="progressbar" aria-valuemin="0" aria-valuenow="0"
                                     aria-valuemax="100" style="width: 0%">
                                </div>
                            </div>

                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div th:replace="fragment/footer :: footer">footer</div>

    </div>

    <!--必须要在content里面-->
    <script th:src="@{js/upload_file.js(t=${timestamp})}" type="text/javascript"/>

</div>
</body>
</html>
